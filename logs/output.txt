(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ make docker-all-dbs
[+] Running 1/1
 ✔ Container container-mongo  Started                                                                              0.4s
[+] Running 1/1
 ✔ Container container-neo4j  Started                                                                              0.3s
[+] Running 1/1
 ✔ Container container-postgres  Started                                                                           0.4s
(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ make docker-workers-dev
[+] Building 3.8s (19/19) FINISHED                                                                       docker:default
 => [internal] load build definition from bookscore.dockerfile                                                     0.1s
 => => transferring dockerfile: 2.30kB                                                                             0.1s
 => [internal] load metadata for docker.io/library/python:3.10-slim                                                0.8s
 => [internal] load .dockerignore                                                                                  0.2s
 => => transferring context: 79B                                                                                   0.1s
 => [internal] load build context                                                                                  0.6s
 => => transferring context: 3.01kB                                                                                0.6s
 => [ 1/14] FROM docker.io/library/python:3.10-slim@sha256:c299e10e0070171113f9a1f109dd05e7e634fa94589b056e0e87bb  0.0s
 => => resolve docker.io/library/python:3.10-slim@sha256:c299e10e0070171113f9a1f109dd05e7e634fa94589b056e0e87bb22  0.0s
 => CACHED [ 2/14] WORKDIR /flask                                                                                  0.0s
 => CACHED [ 3/14] RUN apt-get update && apt-get install -y --no-install-recommends     build-essential make git   0.0s
 => CACHED [ 4/14] COPY deps/bookscore.txt .                                                                       0.0s
 => CACHED [ 5/14] RUN pip install --no-cache-dir -r bookscore.txt                                                 0.0s
 => CACHED [ 6/14] RUN python -m nltk.downloader punkt punkt_tab                                                   0.0s
 => CACHED [ 7/14] RUN mkdir -p /usr/local/lib/python3.10/site-packages/booookscore/prompts &&     curl -sSL http  0.0s
 => CACHED [ 8/14] RUN pip install --upgrade "openai>=1.35.0"                                                      0.0s
 => CACHED [ 9/14] RUN python - <<'PY'                                                                             0.0s
 => [10/14] COPY src/ src/                                                                                         0.1s
 => [11/14] COPY Makefile ./                                                                                       0.1s
 => [12/14] COPY .env .env                                                                                         0.1s
 => [13/14] RUN make env-docker                                                                                    0.8s
 => [14/14] RUN mv .env.docker .env                                                                                0.6s
 => exporting to image                                                                                             0.2s
 => => exporting layers                                                                                            0.2s
 => => writing image sha256:809964b83d6a4f9a31163815f90d95df49162ed52787f732c3e6d9cb14219725                       0.0s
 => => naming to docker.io/library/dsci-cap-img-bscore-dev:latest                                                  0.0s
[+] Building 2.4s (20/20) FINISHED                                                                       docker:default
 => [internal] load build definition from questeval.dockerfile                                                     0.1s
 => => transferring dockerfile: 5.07kB                                                                             0.1s
 => [internal] load metadata for docker.io/library/python:3.8-slim                                                 0.1s
 => [internal] load .dockerignore                                                                                  0.1s
 => => transferring context: 79B                                                                                   0.1s
 => [ 1/15] FROM docker.io/library/python:3.8-slim@sha256:1d52838af602b4b5a831beb13a0e4d073280665ea7be7f69ce2382f  0.0s
 => [internal] load build context                                                                                  0.5s
 => => transferring context: 3.30kB                                                                                0.4s
 => CACHED [ 2/15] WORKDIR /flask                                                                                  0.0s
 => CACHED [ 3/15] RUN apt-get update && apt-get install -y --no-install-recommends     build-essential make git   0.0s
 => CACHED [ 4/15] COPY deps/questeval.txt .                                                                       0.0s
 => CACHED [ 5/15] RUN pip install --no-cache-dir -r questeval.txt                                                 0.0s
 => CACHED [ 6/15] RUN mkdir -p /root/.cache/huggingface/transformers/ThomasNLG &&     cd /root/.cache/huggingfac  0.0s
 => CACHED [ 7/15] RUN cd /root/.cache/huggingface/transformers &&     git clone https://huggingface.co/bert-base  0.0s
 => CACHED [ 8/15] RUN apt-get remove -y git git-lfs && apt-get autoremove -y && rm -rf /var/lib/apt/lists/*       0.0s
 => CACHED [ 9/15] RUN python3 << 'EOF'                                                                            0.0s
 => CACHED [10/15] RUN python3 << 'EOF'                                                                            0.0s
 => [11/15] COPY src/ src/                                                                                         0.1s
 => [12/15] COPY Makefile ./                                                                                       0.1s
 => [13/15] COPY .env .env                                                                                         0.1s
 => [14/15] RUN make env-docker                                                                                    0.6s
 => [15/15] RUN mv .env.docker .env                                                                                0.4s
 => exporting to image                                                                                             0.2s
 => => exporting layers                                                                                            0.2s
 => => writing image sha256:44e8d671c990648ad76f471063e149574c648a8d9453c709e7d681011c041245                       0.0s
 => => naming to docker.io/library/dsci-cap-img-qeval-dev:latest                                                   0.0s
container-qeval
WARNING: Your kernel does not support swap limit capabilities or the cgroup is not mounted. Memory limited without swap.
9cd60e382f5b01d77ee3f1670b5581bad9522abc306c266ee592057033c94758
Network 'capstone_default' already exists; continue...
container-qeval
container-bscore
1af3504a059791bbee336e86eabe22cdd9b717306b48c454a64d22b05237548b
Network 'capstone_default' already exists; continue...
container-bscore
(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ make docker-python-dev
[+] Building 2.1s (20/20) FINISHED                                                                       docker:default
 => [internal] load build definition from python.dockerfile                                                        0.0s
 => => transferring dockerfile: 1.45kB                                                                             0.0s
 => [internal] load metadata for docker.io/library/python:3.12-slim                                                0.2s
 => [internal] load .dockerignore                                                                                  0.1s
 => => transferring context: 79B                                                                                   0.0s
 => [ 1/15] FROM docker.io/library/python:3.12-slim@sha256:b43ff04d5df04ad5cabb80890b7ef74e8410e3395b19af970dcd52  0.0s
 => => resolve docker.io/library/python:3.12-slim@sha256:b43ff04d5df04ad5cabb80890b7ef74e8410e3395b19af970dcd52d7  0.0s
 => [internal] load build context                                                                                  1.1s
 => => transferring context: 10.01MB                                                                               1.0s
 => CACHED [ 2/15] WORKDIR /pipeline                                                                               0.0s
 => CACHED [ 3/15] RUN apt-get update && apt-get install -y --no-install-recommends     build-essential     make   0.0s
 => CACHED [ 4/15] COPY deps/requirements.txt .                                                                    0.0s
 => CACHED [ 5/15] RUN pip install --no-cache-dir -r requirements.txt                                              0.0s
 => CACHED [ 6/15] COPY src/ src/                                                                                  0.0s
 => CACHED [ 7/15] COPY tests/ tests/                                                                              0.0s
 => CACHED [ 8/15] COPY smoke/ smoke/                                                                              0.0s
 => CACHED [ 9/15] COPY datasets/ datasets/                                                                        0.0s
 => CACHED [10/15] COPY .env .env                                                                                  0.0s
 => CACHED [11/15] COPY Makefile .                                                                                 0.0s
 => CACHED [12/15] RUN make env-docker                                                                             0.0s
 => CACHED [13/15] RUN mv .env.docker .env                                                                         0.0s
 => CACHED [14/15] COPY pyproject.toml pytest.ini conftest.py .                                                    0.0s
 => CACHED [15/15] COPY logs/elapsed_time.csv logs/                                                                0.0s
 => exporting to image                                                                                             0.0s
 => => exporting layers                                                                                            0.0s
 => => writing image sha256:b4c05b650e872c0132c543dd2d81603378df8a98f19a62e4369ad0803cb8fdc3                       0.0s
 => => naming to docker.io/library/dsci-cap-img-python-dev:latest                                                  0.0s
container-python
cce4459cd660b5febb42727fcb204509f38ba6f013af080f8243433f46a3db4d
Network 'capstone_default' already exists; continue...
Deleted old chunks...
 * Serving Flask app 'src.core.boss'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5054
 * Running on http://172.17.0.4:5054
Press CTRL+C to quit
[STATUS] Story 1: preprocessing -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:33] "POST /status/story HTTP/1.1" 200 -
[STATUS] Story 1: chunking -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:33] "POST /status/story HTTP/1.1" 200 -

==================================================
Processing: ./tests/examples-pipeline/epub/trilogy-wishes-2.epub
[TIME] task_01_convert_epub took 2.354s
[TIME] task_02_parse_chapters took 0.030s
[TIME] task_03_chunk_story took 0.015s

=== STORY SUMMARY ===
Total chunks: 254
[TIME] pipeline_A took 2.468s
[STATUS] Story 1: preprocessing -> completed
127.0.0.1 - - [07/Dec/2025 19:14:35] "POST /status/story HTTP/1.1" 200 -
[STATUS] Story 1: chunking -> completed
127.0.0.1 - - [07/Dec/2025 19:14:35] "POST /status/story HTTP/1.1" 200 -
[TIME] task_10_sample_chunks took 0.000s
[TIME] task_10_random_chunk took 0.022s

Chunk details:
  index: 140

The latch rattled, and clicked. Then the flap of the letter-box lifted itself—every one saw it by the flickering light of the gas-lamp that shone through the leafless lime-tree by the gate—a golden eye seemed to wink at them through the letter-slit, and a cautious beak whispered—
‘Are you alone?’
‘It’s the Phoenix,’ said every one, in a voice so joyous, and so full of relief, as to be a sort of whispered shout.
‘Hush!’ said the voice from the letter-box slit. ‘Your slaves have gone a-merry-making. The latch of this portal is too stiff for my beak. But at the side—the little window above the shelf whereon your bread lies—it is not fastened.’
‘Righto!’ said Cyril.
And Anthea added, ‘I wish you’d meet us there, dear Phoenix.’
The children crept round to the pantry window. It is at the side of the house, and there is a green gate labelled ‘Tradesmen’s Entrance’, which is always kept bolted. But if you get one foot on the fence between you and next door, and one on the handle of the gate, you are over before you know where you are. This, at least, was the experience of Cyril and Robert, and even, if the truth must be told, of Anthea and Jane. So in almost no time all four were in the narrow gravelled passage that runs between that house and the next.
[TIME] task_11_send_chunk took 0.033s
    [Inserted chunk into Mongo with chunk_id: story-1_book-2_chapter-12_p.20963]
Spacy model 'en_core_web_sm' not found. Downloading...
Collecting en-core-web-sm==3.8.0
  Downloading https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.8.0/en_core_web_sm-3.8.0-py3-none-any.whl (12.8 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 12.8/12.8 MB 42.5 MB/s  0:00:00
Installing collected packages: en-core-web-sm
Successfully installed en-core-web-sm-3.8.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
✔ Download and installation successful
You can now load the package via spacy.load('en_core_web_sm')
[TIME] task_12_relation_extraction_textacy took 3.816s

NLP output:
{'s': 'flap', 'r': 'lifted', 'o': 'itself'}
{'s': 'one', 'r': 'saw', 'o': 'it'}
{'s': 'eye', 'r': 'seemed', 'o': 'to wink at them through the letter - slit'}
{'s': 'beak', 'r': 'whispered', 'o': 'Are you alone'}
{'s': 'slaves', 'r': 'have gone', 'o': 'merry making'}
{'s': 'it', 'r': 'is not fastened', 'o': '‘ Righto ! ’'}
{'s': 'I', 'r': 'wish', 'o': 'you'}
{'s': 'which', 'r': 'is kept', 'o': 'bolted'}
{'s': 'you', 'r': 'get', 'o': 'foot'}

[TIME] task_13_concatenate_triples took 0.000s
[TIME] task_14_relation_extraction_llm_openai took 6.001s

    LLM prompt:
Here are some semantic triples extracted from a story chunk:
{'s': 'flap', 'r': 'lifted', 'o': 'itself'}
{'s': 'one', 'r': 'saw', 'o': 'it'}
{'s': 'eye', 'r': 'seemed', 'o': 'to wink at them through the letter - slit'}
{'s': 'beak', 'r': 'whispered', 'o': 'Are you alone'}
{'s': 'slaves', 'r': 'have gone', 'o': 'merry making'}
{'s': 'it', 'r': 'is not fastened', 'o': '‘ Righto ! ’'}
{'s': 'I', 'r': 'wish', 'o': 'you'}
{'s': 'which', 'r': 'is kept', 'o': 'bolted'}
{'s': 'you', 'r': 'get', 'o': 'foot'}

And here is the original text:
The latch rattled, and clicked. Then the flap of the letter-box lifted itself—every one saw it by the flickering light of the gas-lamp that shone through the leafless lime-tree by the gate—a golden eye seemed to wink at them through the letter-slit, and a cautious beak whispered—
‘Are you alone?’
‘It’s the Phoenix,’ said every one, in a voice so joyous, and so full of relief, as to be a sort of whispered shout.
‘Hush!’ said the voice from the letter-box slit. ‘Your slaves have gone a-merry-making. The latch of this portal is too stiff for my beak. But at the side—the little window above the shelf whereon your bread lies—it is not fastened.’
‘Righto!’ said Cyril.
And Anthea added, ‘I wish you’d meet us there, dear Phoenix.’
The children crept round to the pantry window. It is at the side of the house, and there is a green gate labelled ‘Tradesmen’s Entrance’, which is always kept bolted. But if you get one foot on the fence between you and next door, and one on the handle of the gate, you are over before you know where you are. This, at least, was the experience of Cyril and Robert, and even, if the truth must be told, of Anthea and Jane. So in almost no time all four were in the narrow gravelled passage that runs between that house and the next.

Output JSON with keys: s (subject), r (relation), o (object).
Remove nonsensical triples but otherwise retain all relevant entries, and add new ones to encapsulate events, dialogue, and core meaning where applicable.

    LLM output:
[
  {"s": "latch", "r": "rattled", "o": "and clicked"},
  {"s": "flap", "r": "lifted", "o": "itself"},
  {"s": "one", "r": "saw", "o": "the flap lifted itself"},
  {"s": "gas-lamp", "r": "shone through", "o": "the leafless lime-tree by the gate"},
  {"s": "eye", "r": "seemed", "o": "to wink at them through the letter-slit"},
  {"s": "letter-box", "r": "slit", "o": "letter-slit"},
  {"s": "beak", "r": "whispered", "o": "Are you alone"},
  {"s": "it", "r": "is", "o": "the Phoenix"},
  {"s": "Phoenix", "r": "said", "o": "every one, in a voice so joyous and full of relief"},
  {"s": "slaves", "r": "have gone", "o": "a-merry-making"},
  {"s": "latch", "r": "is", "o": "too stiff for my beak"},
  {"s": "beak", "r": "note", "o": "the latch of this portal is too stiff for my beak"},
  {"s": "side window", "r": "is", "o": "above the shelf where bread lies"},
  {"s": "window", "r": "is not fastened", "o": "at the side—the little window above the shelf whereon your bread lies"},
  {"s": "Cyril", "r": "said", "o": "Righto!"},
  {"s": "Anthea", "r": "added", "o": "I wish you’d meet us there, dear Phoenix"},
  {"s": "children", "r": "crept", "o": "round to the pantry window"},
  {"s": "pantry window", "r": "is", "o": "at the side of the house"},
  {"s": "Tradesmen’s Entrance", "r": "is labelled", "o": "green gate"},
  {"s": "gate", "r": "is kept", "o": "bolted"},
  {"s": "gate", "r": "is", "o": "between the side of the house and the next door"},
  {"s": "fence", "r": "is", "o": "between you and next door"},
  {"s": "you", "r": "get", "o": "one foot on the fence and one on the handle of the gate"},
  {"s": "they", "r": "are", "o": "over before you know where you are"},
  {"s": "Cyril", "r": "experience", "o": "almost no time all four were in the narrow gravelled passage"}
]

==================================================

[TIME] task_15_sanitize_triples_llm took 0.000s
Moderation: filtered 0/25 triples
[TIME] task_16_moderate_triples_llm took 1.615s

Valid JSON
[TIME] pipeline_B took 11.955s
Checkpoint saved to ./datasets/checkpoint.pkl
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: relation_extraction -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:47] "POST /status/chunk HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: llm_inference -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:47] "POST /status/chunk HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: relation_extraction -> completed
127.0.0.1 - - [07/Dec/2025 19:14:47] "POST /status/chunk HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: llm_inference -> completed
127.0.0.1 - - [07/Dec/2025 19:14:47] "POST /status/chunk HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: graph_verbalization -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:47] "POST /status/chunk HTTP/1.1" 200 -
latch rattled and clicked
flap lifted itself
one saw the flap lifted itself
gas-lamp shone through the leafless lime-tree by the gate
eye seemed to wink at them through the letter-slit
letter-box slit letter-slit
beak whispered Are you alone
it is the Phoenix
Phoenix said every one, in a voice so joyous and full of relief
slaves have gone a-merry-making
latch is too stiff for my beak
beak note the latch of this portal is too stiff for my beak
side window is above the shelf where bread lies
window is not fastened at the side—the little window above the shelf whereon your bread lies
Cyril said Righto!
Anthea added I wish you’d meet us there, dear Phoenix
children crept round to the pantry window
pantry window is at the side of the house
Tradesmen’s Entrance is labelled green gate
gate is kept bolted
gate is between the side of the house and the next door
fence is between you and next door
you get one foot on the fence and one on the handle of the gate
they are over before you know where you are
Cyril experience almost no time all four were in the narrow gravelled passage
[TIME] task_20_send_triples took 5.434s
[TIME] task_21_1_describe_graph took 0.225s

Most relevant nodes:
   edge_count node_name
0           2     Cyril
1           2   Phoenix
2           2      beak
[TIME] task_22_verbalize_triples took 0.199s

Triples which best represent the graph:
beak WHISPERED Are_alone
Phoenix SAID one_in_voice_so_joyous_and_full_of_relief
beak NOTE latch_of_portal_is_too_stiff_for_beak
Cyril SAID Righto
Cyril EXPERIENCE almost_time_four_were_in_narrow_gravelled_passage

[TIME] pipeline_C took 5.954s
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: graph_verbalization -> completed
127.0.0.1 - - [07/Dec/2025 19:14:53] "POST /status/chunk HTTP/1.1" 200 -
[STATUS] Story 1: summarization -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:53] "POST /status/story HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: summarization -> in-progress
127.0.0.1 - - [07/Dec/2025 19:14:53] "POST /status/chunk HTTP/1.1" 200 -
[TIME] task_30_summarize_llm_openai took 2.003s

Generated summary:
In the scene, a beak whispered that it was alone. A phoenix spoke with joyful relief. The beak noted that the latch of a portal was too stiff for it. Cyril said “Righto,” and Cyril experienced that they were nearly at a time when four of them would be in a narrow, gravelled passage.
[TIME] task_31_send_summary took 0.002s
    [Wrote summary to Mongo with chunk_id: story-1_book-2_chapter-12_p.20963]
[TIME] pipeline_D took 2.068s
[STATUS] Story 1: summarization -> completed
127.0.0.1 - - [07/Dec/2025 19:14:55] "POST /status/story HTTP/1.1" 200 -
[STATUS] Chunk story-1_book-2_chapter-12_p.20963: summarization -> completed
127.0.0.1 - - [07/Dec/2025 19:14:55] "POST /status/chunk HTTP/1.1" 200 -
[ASSIGNED] chunk 'story-1_book-2_chapter-12_p.20963' to worker questeval: using database 'conan_capstone' and collection 'story_chunks'
127.0.0.1 - - [07/Dec/2025 19:14:55] "POST /process_story HTTP/1.1" 200 -
Triggered questeval: {'assigned': 1, 'status': 'tasks_assigned', 'story_id': 1, 'task_type': 'questeval', 'total_chunks': 1}
[CALLBACK] chunk_id=story-1_book-2_chapter-12_p.20963, task=questeval, status=started
172.18.0.5 - - [07/Dec/2025 19:14:55] "POST /callback HTTP/1.1" 200 -
[ASSIGNED] chunk 'story-1_book-2_chapter-12_p.20963' to worker bookscore: using database 'conan_capstone' and collection 'story_chunks'
127.0.0.1 - - [07/Dec/2025 19:14:55] "POST /process_story HTTP/1.1" 200 -
Triggered bookscore: {'assigned': 1, 'status': 'tasks_assigned', 'story_id': 1, 'task_type': 'bookscore', 'total_chunks': 1}

=== TIMING SUMMARY ===
                                        calls      total        avg        min        max
function
pipeline_A                                  1   2.468319   2.468319   2.468319   2.468319
pipeline_B                                  1  11.954744  11.954744  11.954744  11.954744
pipeline_C                                  1   5.953820   5.953820   5.953820   5.953820
pipeline_D                                  1   2.067681   2.067681   2.067681   2.067681
task_01_convert_epub                        1   2.353805   2.353805   2.353805   2.353805
task_02_parse_chapters                      1   0.029561   0.029561   0.029561   0.029561
task_03_chunk_story                         1   0.015017   0.015017   0.015017   0.015017
task_10_random_chunk                        1   0.021795   0.021795   0.021795   0.021795
task_10_sample_chunks                       1   0.000030   0.000030   0.000030   0.000030
task_11_send_chunk                          1   0.032784   0.032784   0.032784   0.032784
task_12_relation_extraction_textacy         1   3.815531   3.815531   3.815531   3.815531
task_13_concatenate_triples                 1   0.000066   0.000066   0.000066   0.000066
task_14_relation_extraction_llm_openai      1   6.000680   6.000680   6.000680   6.000680
task_15_sanitize_triples_llm                1   0.000335   0.000335   0.000335   0.000335
task_16_moderate_triples_llm                1   1.615430   1.615430   1.615430   1.615430
task_20_send_triples                        1   5.434274   5.434274   5.434274   5.434274
task_21_1_describe_graph                    1   0.225327   0.225327   0.225327   0.225327
task_22_verbalize_triples                   1   0.199480   0.199480   0.199480   0.199480
task_30_summarize_llm_openai                1   2.003011   2.003011   2.003011   2.003011
task_31_send_summary                        1   0.002053   0.002053   0.002053   0.002053

Total execution time: 44.194s
[CALLBACK] chunk_id=story-1_book-2_chapter-12_p.20963, task=bookscore, status=started
172.18.0.6 - - [07/Dec/2025 19:14:55] "POST /callback HTTP/1.1" 200 -
[DUMP] Saved time records to './logs/elapsed_time.csv'
[CHART] Saved chart 'Average Function Runtime Across Runs' to ./logs/charts/avg_runtime.png
Initial processing complete. Server listening for additional requests from Blazor...
Press Ctrl+C to stop.
[CALLBACK] chunk_id=story-1_book-2_chapter-12_p.20963, task=bookscore, status=completed
[TIME] worker_metric_bookscore took 14.353s
[STORY COMPLETE] All chunks completed metric_bookscore for story 1

=== TIMING SUMMARY ===
                                        calls      total        avg        min        max
function
pipeline_A                                  1   2.468319   2.468319   2.468319   2.468319
pipeline_B                                  1  11.954744  11.954744  11.954744  11.954744
pipeline_C                                  1   5.953820   5.953820   5.953820   5.953820
pipeline_D                                  1   2.067681   2.067681   2.067681   2.067681
task_01_convert_epub                        1   2.353805   2.353805   2.353805   2.353805
task_02_parse_chapters                      1   0.029561   0.029561   0.029561   0.029561
task_03_chunk_story                         1   0.015017   0.015017   0.015017   0.015017
task_10_random_chunk                        1   0.021795   0.021795   0.021795   0.021795
task_10_sample_chunks                       1   0.000030   0.000030   0.000030   0.000030
task_11_send_chunk                          1   0.032784   0.032784   0.032784   0.032784
task_12_relation_extraction_textacy         1   3.815531   3.815531   3.815531   3.815531
task_13_concatenate_triples                 1   0.000066   0.000066   0.000066   0.000066
task_14_relation_extraction_llm_openai      1   6.000680   6.000680   6.000680   6.000680
task_15_sanitize_triples_llm                1   0.000335   0.000335   0.000335   0.000335
task_16_moderate_triples_llm                1   1.615430   1.615430   1.615430   1.615430
task_20_send_triples                        1   5.434274   5.434274   5.434274   5.434274
task_21_1_describe_graph                    1   0.225327   0.225327   0.225327   0.225327
task_22_verbalize_triples                   1   0.199480   0.199480   0.199480   0.199480
task_30_summarize_llm_openai                1   2.003011   2.003011   2.003011   2.003011
task_31_send_summary                        1   0.002053   0.002053   0.002053   0.002053
worker_metric_bookscore                     1  14.352664  14.352664  14.352664  14.352664

Total execution time: 58.546s
[DUMP] Saved time records to './logs/elapsed_time.csv'
[CHART] Saved chart 'Average Function Runtime Across Runs' to ./logs/charts/avg_runtime.png
172.18.0.6 - - [07/Dec/2025 19:15:11] "POST /callback HTTP/1.1" 200 -
[CALLBACK] chunk_id=story-1_book-2_chapter-12_p.20963, task=questeval, status=completed
[TIME] worker_metric_questeval took 200.108s
[STORY COMPLETE] All chunks completed metric_questeval for story 1

=== TIMING SUMMARY ===
                                        calls       total         avg         min         max
function
pipeline_A                                  1    2.468319    2.468319    2.468319    2.468319
pipeline_B                                  1   11.954744   11.954744   11.954744   11.954744
pipeline_C                                  1    5.953820    5.953820    5.953820    5.953820
pipeline_D                                  1    2.067681    2.067681    2.067681    2.067681
task_01_convert_epub                        1    2.353805    2.353805    2.353805    2.353805
task_02_parse_chapters                      1    0.029561    0.029561    0.029561    0.029561
task_03_chunk_story                         1    0.015017    0.015017    0.015017    0.015017
task_10_random_chunk                        1    0.021795    0.021795    0.021795    0.021795
task_10_sample_chunks                       1    0.000030    0.000030    0.000030    0.000030
task_11_send_chunk                          1    0.032784    0.032784    0.032784    0.032784
task_12_relation_extraction_textacy         1    3.815531    3.815531    3.815531    3.815531
task_13_concatenate_triples                 1    0.000066    0.000066    0.000066    0.000066
task_14_relation_extraction_llm_openai      1    6.000680    6.000680    6.000680    6.000680
task_15_sanitize_triples_llm                1    0.000335    0.000335    0.000335    0.000335
task_16_moderate_triples_llm                1    1.615430    1.615430    1.615430    1.615430
task_20_send_triples                        1    5.434274    5.434274    5.434274    5.434274
task_21_1_describe_graph                    1    0.225327    0.225327    0.225327    0.225327
task_22_verbalize_triples                   1    0.199480    0.199480    0.199480    0.199480
task_30_summarize_llm_openai                1    2.003011    2.003011    2.003011    2.003011
task_31_send_summary                        1    0.002053    0.002053    0.002053    0.002053
worker_metric_bookscore                     1   14.352664   14.352664   14.352664   14.352664
worker_metric_questeval                     1  200.107767  200.107767  200.107767  200.107767

Total execution time: 258.654s
[DUMP] Saved time records to './logs/elapsed_time.csv'
[CHART] Saved chart 'Average Function Runtime Across Runs' to ./logs/charts/avg_runtime.png
Downloading builder script: 6.14kB [00:00, 15.0MB/s]
Downloading builder script: 7.95kB [00:00, 17.7MB/s]
Some weights of RobertaModel were not initialized from the model checkpoint at roberta-large and are newly initialized: ['pooler.dense.bias', 'pooler.dense.weight']
You should probably TRAIN this model on a down-stream task to be able to use it for predictions and inference.
Sending payload to Blazor at http://blazor_service:5055/api/metrics
POST succeeded
{'bookID': '2', 'bookTitle': 'The Phoenix and the Carpet', 'summaryText': 'In the scene, a beak whispered that it was alone. A phoenix spoke with joyful relief. The beak noted that the latch of a portal was too stiff for it. Cyril said “Righto,” and Cyril experienced that they were nearly at a time when four of them would be in a narrow, gravelled passage.', 'goldSummaryText': 'The latch rattled, and clicked. Then the flap of the letter-box lifted itself—every one saw it by the flickering light of the gas-lamp that shone through the leafless lime-tree by the gate—a golden eye seemed to wink at them through the letter-slit, and a cautious beak whispered—\n‘Are you alone?’\n‘It’s the Phoenix,’ said every one, in a voice so joyous, and so full of relief, as to be a sort of whispered shout.\n‘Hush!’ said the voice from the letter-box slit. ‘Your slaves have gone a-merry-making. The latch of this portal is too stiff for my beak. But at the side—the little window above the shelf whereon your bread lies—it i', 'metrics': {'prF1Metrics': [{'name': 'BERTScore', 'precision': 0.8531359434127808, 'recall': 0.8219007849693298, 'f1Score': 0.8372271656990051}], 'qa': {'qaItems': [{'question': 'UNKNOWN', 'goldAnswer': 'UNKNOWN', 'generatedAnswer': 'UNKNOWN', 'isCorrect': False, 'accuracy': 0}, {'question': 'UNKNOWN', 'goldAnswer': 'UNKNOWN', 'generatedAnswer': 'UNKNOWN', 'isCorrect': False, 'accuracy': 0}], 'averageAccuracy': 0}, 'scalarMetrics': [{'name': 'BooookScore (Chang 2024)', 'value': 0}, {'name': 'QuestEval (Scialom 2021)', 'value': 0.31805071628053116}, {'name': 'ROUGE-1', 'value': 0.3370786516853933}, {'name': 'ROUGE-2', 'value': 0.06818181818181818}, {'name': 'ROUGE-L', 'value': 0.1797752808988764}, {'name': 'ROUGE-Lsum', 'value': 0.24719101123595505}]}, 'qaResults': []}
[TIME] task_40_post_payload took 40.425s

Output sent to web app.
[TIME] pipeline_E took 40.428s
[PIPELINE FINALIZED] Story 1 fully processed

=== TIMING SUMMARY ===
                                        calls       total         avg         min         max
function
pipeline_A                                  1    2.468319    2.468319    2.468319    2.468319
pipeline_B                                  1   11.954744   11.954744   11.954744   11.954744
pipeline_C                                  1    5.953820    5.953820    5.953820    5.953820
pipeline_D                                  1    2.067681    2.067681    2.067681    2.067681
pipeline_E                                  1   40.428340   40.428340   40.428340   40.428340
task_01_convert_epub                        1    2.353805    2.353805    2.353805    2.353805
task_02_parse_chapters                      1    0.029561    0.029561    0.029561    0.029561
task_03_chunk_story                         1    0.015017    0.015017    0.015017    0.015017
task_10_random_chunk                        1    0.021795    0.021795    0.021795    0.021795
task_10_sample_chunks                       1    0.000030    0.000030    0.000030    0.000030
task_11_send_chunk                          1    0.032784    0.032784    0.032784    0.032784
task_12_relation_extraction_textacy         1    3.815531    3.815531    3.815531    3.815531
task_13_concatenate_triples                 1    0.000066    0.000066    0.000066    0.000066
task_14_relation_extraction_llm_openai      1    6.000680    6.000680    6.000680    6.000680
task_15_sanitize_triples_llm                1    0.000335    0.000335    0.000335    0.000335
task_16_moderate_triples_llm                1    1.615430    1.615430    1.615430    1.615430
task_20_send_triples                        1    5.434274    5.434274    5.434274    5.434274
task_21_1_describe_graph                    1    0.225327    0.225327    0.225327    0.225327
task_22_verbalize_triples                   1    0.199480    0.199480    0.199480    0.199480
task_30_summarize_llm_openai                1    2.003011    2.003011    2.003011    2.003011
task_31_send_summary                        1    0.002053    0.002053    0.002053    0.002053
task_40_post_payload                        1   40.424673   40.424673   40.424673   40.424673
worker_metric_bookscore                     1   14.352664   14.352664   14.352664   14.352664
worker_metric_questeval                     1  200.107767  200.107767  200.107767  200.107767

Total execution time: 339.507s
[DUMP] Saved time records to './logs/elapsed_time.csv'
[CHART] Saved chart 'Average Function Runtime Across Runs' to ./logs/charts/avg_runtime.png
172.18.0.5 - - [07/Dec/2025 19:18:57] "POST /callback HTTP/1.1" 200 -
INFO:werkzeug:172.18.0.5 - - [07/Dec/2025 19:18:57] "POST /callback HTTP/1.1" 200 -
^Cmake[2]: *** [Makefile:77: docker-start] Interrupt
make[1]: *** [Makefile:89: docker-python] Interrupt
make: *** [Makefile:130: docker-python-dev] Interrupt

(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ docker logs container-bscore
 * Serving Flask app 'worker'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5002
 * Running on http://172.17.0.3:5002
Press CTRL+C to quit
[QUEUED] chunk 'story-1_book-2_chapter-12_p.20963' from Boss: using database 'conan_capstone' and collection 'story_chunks'
172.18.0.7 - - [07/Dec/2025 19:14:55] "POST /tasks/queue HTTP/1.1" 202 -
FINISHED: chunk ID: story-1_book-2_chapter-12_p.20963, result:
{'value': 0.0, 'annotations': {'In the scene, a beak whispered that it was alone.': {'questions': 'What does the beak refer to? Is it a literal beak or a metaphor? Why is the beak alone?', 'types': ['entity omission', 'causal omission']}, 'A phoenix spoke with joyful relief.': {'questions': "Why is the phoenix relieved? What is the context of its relief? What does the phoenix's relief signify in the story?", 'types': ['causal omission', 'entity omission']}, 'The beak noted that the latch of a portal was too stiff for it.': {'questions': 'What is the significance of the beak? What portal is being referred to? Why is the latch stiff?', 'types': ['entity omission', 'event omission']}, 'Cyril said “Righto,” and Cyril experienced that they were nearly at a time when four of them would be in a narrow, gravelled passage.': {'questions': 'What does Cyril mean by "Righto"? What is the significance of the "narrow, gravelled passage"? Who are the four of them?', 'types': ['entity omission', 'event omission', 'causal omission']}}, 'model_used': 'openai-model_gpt-4o-mini'}
(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ docker logs container-qeval
Downloading: 6.81kB [00:00, 5.74MB/s]
WARNING:root:Downloading language model for the spaCy model.
DEPRECATION: https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.0.0/en_core_web_sm-3.0.0-py3-none-any.whl#egg=en_core_web_sm==3.0.0 contains an egg fragment with a non-PEP 508 name. pip 25.1 will enforce this behaviour change. A possible replacement is to use the req @ url syntax, and remove the egg fragment. Discussion can be found at https://github.com/pypa/pip/issues/13157
Collecting en-core-web-sm==3.0.0
  Downloading https://github.com/explosion/spacy-models/releases/download/en_core_web_sm-3.0.0/en_core_web_sm-3.0.0-py3-none-any.whl (13.7 MB)
     ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ 13.7/13.7 MB 36.2 MB/s eta 0:00:00
Requirement already satisfied: spacy<3.1.0,>=3.0.0 in /usr/local/lib/python3.8/site-packages (from en-core-web-sm==3.0.0) (3.0.6)
Requirement already satisfied: spacy-legacy<3.1.0,>=3.0.4 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (3.0.12)
Requirement already satisfied: murmurhash<1.1.0,>=0.28.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (1.0.13)
Requirement already satisfied: cymem<2.1.0,>=2.0.2 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.0.11)
Requirement already satisfied: preshed<3.1.0,>=3.0.2 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (3.0.10)
Requirement already satisfied: thinc<8.1.0,>=8.0.3 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (8.0.17)
Requirement already satisfied: blis<0.8.0,>=0.4.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (0.7.11)
Requirement already satisfied: wasabi<1.1.0,>=0.8.1 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (0.10.1)
Requirement already satisfied: srsly<3.0.0,>=2.4.1 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.4.8)
Requirement already satisfied: catalogue<2.1.0,>=2.0.3 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.0.10)
Requirement already satisfied: typer<0.4.0,>=0.3.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (0.3.2)
Requirement already satisfied: pathy>=0.3.5 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (0.11.0)
Requirement already satisfied: tqdm<5.0.0,>=4.38.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (4.49.0)
Requirement already satisfied: numpy>=1.15.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (1.24.4)
Requirement already satisfied: requests<3.0.0,>=2.13.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.32.4)
Requirement already satisfied: pydantic<1.8.0,>=1.7.1 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (1.7.4)
Requirement already satisfied: jinja2 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.11.3)
Requirement already satisfied: setuptools in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (75.3.2)
Requirement already satisfied: packaging>=20.0 in /usr/local/lib/python3.8/site-packages (from spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (25.0)
Requirement already satisfied: smart-open<7.0.0,>=5.2.1 in /usr/local/lib/python3.8/site-packages (from pathy>=0.3.5->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (6.4.0)
Requirement already satisfied: pathlib-abc==0.1.1 in /usr/local/lib/python3.8/site-packages (from pathy>=0.3.5->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (0.1.1)
Requirement already satisfied: charset_normalizer<4,>=2 in /usr/local/lib/python3.8/site-packages (from requests<3.0.0,>=2.13.0->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (3.4.4)
Requirement already satisfied: idna<4,>=2.5 in /usr/local/lib/python3.8/site-packages (from requests<3.0.0,>=2.13.0->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (3.11)
Requirement already satisfied: urllib3<3,>=1.21.1 in /usr/local/lib/python3.8/site-packages (from requests<3.0.0,>=2.13.0->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2.2.3)
Requirement already satisfied: certifi>=2017.4.17 in /usr/local/lib/python3.8/site-packages (from requests<3.0.0,>=2.13.0->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (2025.10.5)
Requirement already satisfied: click<7.2.0,>=7.1.1 in /usr/local/lib/python3.8/site-packages (from typer<0.4.0,>=0.3.0->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (7.1.2)
Requirement already satisfied: MarkupSafe>=0.23 in /usr/local/lib/python3.8/site-packages (from jinja2->spacy<3.1.0,>=3.0.0->en-core-web-sm==3.0.0) (1.1.1)
Installing collected packages: en-core-web-sm
Successfully installed en-core-web-sm-3.0.0
WARNING: Running pip as the 'root' user can result in broken permissions and conflicting behaviour with the system package manager, possibly rendering your system unusable. It is recommended to use a virtual environment instead: https://pip.pypa.io/warnings/venv. Use the --root-user-action option if you know what you are doing and want to suppress this warning.
✔ Download and installation successful
You can now load the package via spacy.load('en_core_web_sm')







 * Serving Flask app "worker" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
INFO:werkzeug: * Running on http://0.0.0.0:5001/ (Press CTRL+C to quit)
[QUEUED] chunk 'story-1_book-2_chapter-12_p.20963' from Boss: using database 'conan_capstone' and collection 'story_chunks'
INFO:werkzeug:172.18.0.7 - - [07/Dec/2025 19:14:55] "POST /tasks/queue HTTP/1.1" 202 -
Some weights of the model checkpoint at /root/.cache/huggingface/transformers/bert-base-multilingual-cased were not used when initializing BertModel: ['cls.predictions.transform.dense.bias', 'cls.seq_relationship.weight', 'cls.predictions.transform.dense.weight', 'cls.seq_relationship.bias', 'cls.predictions.bias', 'cls.predictions.decoder.weight', 'cls.predictions.transform.LayerNorm.weight', 'cls.predictions.transform.LayerNorm.bias']
- This IS expected if you are initializing BertModel from the checkpoint of a model trained on another task or with another architecture (e.g. initializing a BertForSequenceClassification model from a BertForPreTraining model).
- This IS NOT expected if you are initializing BertModel from the checkpoint of a model that you expect to be exactly identical (initializing a BertForSequenceClassification model from a BertForSequenceClassification model).
FINISHED: chunk ID: story-1_book-2_chapter-12_p.20963, result:
{'value': 0.31805071628053116, 'has_reference': False}
Failed to notify boss: HTTPConnectionPool(host='python_service', port=5054): Read timed out. (read timeout=5)