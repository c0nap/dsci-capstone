(env-cap) conanp@RPI-conanp:/mnt/c/dsci-cap/capstone$ make docker-python-dev
[+] Building 0.7s (20/20) FINISHED                                                                       docker:default
 => [internal] load build definition from Dockerfile.python                                                        0.0s
 => => transferring dockerfile: 1.29kB                                                                             0.0s
 => [internal] load metadata for docker.io/library/python:3.12-slim                                                0.2s
 => [internal] load .dockerignore                                                                                  0.1s
 => => transferring context: 79B                                                                                   0.0s
 => [ 1/15] FROM docker.io/library/python:3.12-slim@sha256:e97cf9a2e84d604941d9902f00616db7466ff302af4b1c3c67fb7c  0.0s
 => [internal] load build context                                                                                  0.3s
 => => transferring context: 4.05kB                                                                                0.3s
 => CACHED [ 2/15] WORKDIR /pipeline                                                                               0.0s
 => CACHED [ 3/15] RUN apt-get update && apt-get install -y --no-install-recommends     build-essential make pand  0.0s
 => CACHED [ 4/15] COPY req/requirements.txt requirements.txt                                                      0.0s
 => CACHED [ 5/15] RUN pip install --no-cache-dir -r requirements.txt                                              0.0s
 => CACHED [ 6/15] COPY src/ src/                                                                                  0.0s
 => CACHED [ 7/15] COPY tests/ tests/                                                                              0.0s
 => CACHED [ 8/15] COPY db/ db/                                                                                    0.0s
 => CACHED [ 9/15] COPY components/ components/                                                                    0.0s
 => CACHED [10/15] COPY datasets/ datasets/                                                                        0.0s
 => CACHED [11/15] COPY .env .env                                                                                  0.0s
 => CACHED [12/15] COPY Makefile .                                                                                 0.0s
 => CACHED [13/15] RUN make env-docker                                                                             0.0s
 => CACHED [14/15] RUN mv .env.docker .env                                                                         0.0s
 => CACHED [15/15] COPY pyproject.toml .                                                                           0.0s
 => exporting to image                                                                                             0.0s
 => => exporting layers                                                                                            0.0s
 => => writing image sha256:07927b48b17e3403c872a5a96e1e53dcb5754135149ad83083f86c0c791e0ad0                       0.0s
 => => naming to docker.io/library/dsci-cap-img-python-dev:latest                                                  0.0s
container-python
9d27dc95c3938bce7f4ec3f048db67ceed16c7fb87c531e10275aff1278302c6
Network 'capstone_default' already exists; continue...
 * Serving Flask app 'main'
 * Debug mode: off
WARNING: This is a development server. Do not use it in a production deployment. Use a production WSGI server instead.
 * Running on all addresses (0.0.0.0)
 * Running on http://127.0.0.1:5054
 * Running on http://172.17.0.4:5054
Press CTRL+C to quit

==================================================
Processing: ./datasets/examples/trilogy-wishes-2.epub

=== STORY SUMMARY ===
Total chunks: 254

Chunk details:
  index: Chunk(len=1079, book=2, chapter=9, story=1, lines=[1951,1969], story%=30.095, chapter%=14.065)

So that when Wednesday afternoon brought an unexpected holiday, and every one decided to go somewhere on the carpet, the journey had to be undertaken without the Phoenix. They were debarred from any carpet excursions in the evening by a sudden promise to mother, exacted in the agitation of parting, that they would not be out after six at night, except on Saturday, when they were to go to the bazaar, and were pledged to put on their best clothes, to wash themselves to the uttermost, and to clean their nails—not with scissors, which are scratchy and bad, but with flat-sharpened ends of wooden matches, which do no harm to any one’s nails.
‘Let’s go and see the Lamb,’ said Jane.
But every one was agreed that if they appeared suddenly in Bournemouth it would frighten mother out of her wits, if not into a fit. So they sat on the carpet, and thought and thought and thought till they almost began to squint.
‘Look here,’ said Cyril, ‘I know. Please carpet, take us somewhere where we can see the Lamb and mother and no one can see us.’
‘Except the Lamb,’ said Jane, quickly.

NLP output:
('John F. Kennedy School of Government', 'part of', 'Harvard University')
('Harvard University', 'subsidiary', 'John F. Kennedy School of Government')
('matches', 'subclass of', 'cutlery')
('the Lamb', 'spouse', 'Jane')
('Jane', 'spouse', 'the Lamb')
('Bournemouth', 'located in the administrative territorial entity', 'Bournemouth')
('thought and thought and thought', 'has part', 'thought')
('thought', 'thought', 'has part')
('thought and thought and thought', 'thought', 'part of')
('Cyril', 'present in work', 'I know')
('I know', 'characters', 'Cyril')
('Lamb', 'mother', 'mother')
('Except the Lamb', 'spouse', 'Jane')
('Jane', 'spouse', 'Except the Lamb')


    LLM prompt:
You are a helpful assistant that converts semantic triples into structured JSON.
Here are some semantic triples extracted from a story chunk:
('John F. Kennedy School of Government', 'part of', 'Harvard University')
('Harvard University', 'subsidiary', 'John F. Kennedy School of Government')
('matches', 'subclass of', 'cutlery')
('the Lamb', 'spouse', 'Jane')
('Jane', 'spouse', 'the Lamb')
('Bournemouth', 'located in the administrative territorial entity', 'Bournemouth')
('thought and thought and thought', 'has part', 'thought')
('thought', 'thought', 'has part')
('thought and thought and thought', 'thought', 'part of')
('Cyril', 'present in work', 'I know')
('I know', 'characters', 'Cyril')
('Lamb', 'mother', 'mother')
('Except the Lamb', 'spouse', 'Jane')
('Jane', 'spouse', 'Except the Lamb')

And here is the original text:
So that when Wednesday afternoon brought an unexpected holiday, and every one decided to go somewhere on the carpet, the journey had to be undertaken without the Phoenix. They were debarred from any carpet excursions in the evening by a sudden promise to mother, exacted in the agitation of parting, that they would not be out after six at night, except on Saturday, when they were to go to the bazaar, and were pledged to put on their best clothes, to wash themselves to the uttermost, and to clean their nails—not with scissors, which are scratchy and bad, but with flat-sharpened ends of wooden matches, which do no harm to any one’s nails.
‘Let’s go and see the Lamb,’ said Jane.
But every one was agreed that if they appeared suddenly in Bournemouth it would frighten mother out of her wits, if not into a fit. So they sat on the carpet, and thought and thought and thought till they almost began to squint.
‘Look here,’ said Cyril, ‘I know. Please carpet, take us somewhere where we can see the Lamb and mother and no one can see us.’
‘Except the Lamb,’ said Jane, quickly.

Output JSON with keys: s (subject), r (relation), o (object).
Remove nonsensical triples but otherwise retain all relevant entries, and add new ones to encapsulate events, dialogue, and core meaning where applicable.

    LLM output:
[
  {"s": "Wednesday afternoon", "r": "brought", "o": "an unexpected holiday"},
  {"s": "they", "r": "decided", "o": "to go somewhere on the carpet"},
  {"s": "the journey", "r": "had to be undertaken", "o": "without the Phoenix"},
  {"s": "they", "r": "were_debarred_from", "o": "carpet excursions in the evening"},
  {"s": "promise", "r": "made_to", "o": "mother"},
  {"s": "promise", "r": "restricts", "o": "they would not be out after six at night"},
  {"s": "Saturday", "r": "exception_for", "o": "going to the bazaar"},
  {"s": "they", "r": "pledged_to", "o": "put on their best clothes"},
  {"s": "they", "r": "pledged_to", "o": "wash themselves to the uttermost"},
  {"s": "they", "r": "pledged_to", "o": "clean their nails with flat-sharpened ends of wooden matches"},
  {"s": "Jane", "r": "said", "o": "Let's go and see the Lamb"},
  {"s": "they", "r": "sat_on", "o": "the carpet"},
  {"s": "they", "r": "thought_about", "o": "how to see the Lamb and mother without being seen"},
  {"s": "Cyril", "r": "said", "o": "Look here"},
  {"s": "Cyril", "r": "said", "o": "I know"},
  {"s": "Cyril", "r": "said", "o": "Please carpet, take us somewhere where we can see the Lamb and mother and no one can see us."},
  {"s": "Jane", "r": "said", "o": "Except the Lamb"}
]

==================================================


Valid JSON
Wednesday afternoon brought an unexpected holiday
they decided to go somewhere on the carpet
the journey had to be undertaken without the Phoenix
they were_debarred_from carpet excursions in the evening
promise made_to mother
promise restricts they would not be out after six at night
Saturday exception_for going to the bazaar
they pledged_to put on their best clothes
they pledged_to wash themselves to the uttermost
they pledged_to clean their nails with flat-sharpened ends of wooden matches
Jane said Let's go and see the Lamb
they sat_on the carpet
they thought_about how to see the Lamb and mother without being seen
Cyril said Look here
Cyril said I know
Cyril said Please carpet, take us somewhere where we can see the Lamb and mother and no one can see us.
Jane said Except the Lamb

Most relevant nodes:
  node_name  edge_count
0      they           7
1     Cyril           3
2   promise           2

Triples which best represent the graph:
they thought_about how_to_see_the_Lamb_and_mother_without_being_seen
they sat_on the_carpet
they pledged_to clean_their_nails_with_flat_sharpened_ends_of_wooden_matches
they pledged_to wash_themselves_to_the_uttermost
they pledged_to put_on_their_best_clothes
they were_debarred_from carpet_excursions_in_the_evening
they decided to_go_somewhere_on_the_carpet
Cyril said Please_carpet__take_us_somewhere_where_we_can_see_the_Lamb_and_mother_and_no_one_can_see_us_
Cyril said I_know
Cyril said Look_here
promise restricts they_would_not_be_out_after_six_at_night
promise made_to mother


Generated summary:
Several individuals plan to travel secretly on the carpet to glimpse the Lamb and their mother unseen by others. They prepare by sitting on the carpet, pledging to clean their nails with the flat ends of wooden matches, washing themselves thoroughly, and putting on their best clothes. Although barred from evening carpet excursions, they decide to go somewhere on the carpet. Cyril asks the carpet to take them to a place where they can see the Lamb and mother without being seen, claiming he knows. A promise to their mother restricts them from being out after six at night.
Sending payload to Blazor at http://blazor_service:5055/api/metrics
Request failed: HTTPConnectionPool(host='blazor_service', port=5055): Max retries exceeded with url: /api/metrics (Caused by NameResolutionError("<urllib3.connection.HTTPConnection object at 0x7d4755b97f50>: Failed to resolve 'blazor_service' ([Errno -3] Temporary failure in name resolution)"))

Output sent to web app.
127.0.0.1 - - [27/Oct/2025 21:00:54] "POST /process_story HTTP/1.1" 404 -
127.0.0.1 - - [27/Oct/2025 21:00:54] "POST /process_story HTTP/1.1" 404 -
Triggered bookscore: {'error': 'No chunks found for story'}
Initial processing complete. Server listening for additional requests from Blazor...
Press Ctrl+C to stop.
# exit